![image](https://github.com/user-attachments/assets/9a7f761a-733c-4b02-9f14-9357825df0d0)# Malware Analysis Report: ultima

## Introduction
This sample is only for educational purposes, and since it doesn't do any real harm, it's perfect for practicing malware analysis skills. It was developed by [cr-0w](https://github.com/cr-0w). Before the actual analysis, it's wise to go over some terminology. Malware analysis comprises two types of analyses: static and dynamic. Static analysis occurs when you only want to find out about the technicalities of the malware. For example, its hash or the malware family to which it belongs. There are great tools that give a comprehensive first look at malware, one of which is VirusTotal. If you've followed through the [lab setup](https://github.com/mushy2005/Malware-Analysis/tree/main/Malware%20Analysis), you'll notice that Flare has many useful tools for malware analysis built right into it.

## Static Analysis
Before diving into either of the analyses, it's wise to learn about the malware as it seems on the surface. One way to achieve this is by placing the sample into [VirusTotal](https://www.virustotal.com/gui/home/upload). Do note that the sample is a locked zip file with a password. To unzip, simply enter the password: `infected`, or you could even do it straight from Flare, like below:<br> 
<img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/infected.png" width=20% height=20%>
- After unzipping, you'll see these two files:<br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/2files.png">
- The only important file is `Ultima.exe.crow`, which is the actual malware. Now, we'll need to find the hashes. We can easily do this by using the `HashMyFiles` application, which comes built-in with FlareVM.<br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/hashes.png">
- Since MD5 and SHA-256 are the most common hash functions, we'll only note those values.<br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/md5-sha256.png" width="70%" height="70%">
- Now, we can either drop the file into VirusTotal or search it up using the hashes just found out, both ways are perfectly fine. Once the sample has been dropped into VirusTotal, here's what you'll get, as well as the link to report: ![VirusTotal Link](https://www.virustotal.com/gui/file/f48f43594cc5563217a6a19d2af2dc8d82f397a98540fd96c0c5b7d6d6a2a402) <br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/VirusTotal.png" width="70%" height="70%">
- As we can see, 35 out of 73 security vendors have flagged this file as malicious. We can also determine the threat category it belongs in, which is `trojan`. Overall, VirusTotal does give a comprehensive overview of the file, however, it shouldn't be the main source of information.
- Now, we'll dive into actual hands-on analysis. Firstly, we need to determine the malware's properties, such as if it is packed or obfuscated, and determine if it's a Portable Executable (PE), as that'll help immensely in our analysis.
- Using our FlareVM setup, we can run an application called `Detect it Easy`, which will give us more information regarding the file's properties. After running it, here's what we get: <br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/Detect.png" width="50%" height="50%">
- As you can see, the sample is a 64-bit Portable Executable (PE) file. It seems to target Windows Systems and is compiled using Microsoft Visual C/C++. Another interesting detail is that the file contains a certificate, which indicates an attempt to make it seem more trustworthy. However, the certificate might be invalid.
- To avoid any problems, we should remove the custom extension that the file comes with, which is `.crow`. The reason behind this is that having the extension might mess with the import functions the malware uses. This is how the file will look like once you remove the extension: <br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/extension.png">
- Now, I'll be using PE-Bear to determine functions the malware imports, as that'll give us an overall picture of its capabilities. Here's what I got after running PE-Bear: <br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/pbr.png" width="60%" height="60%">
- For now, our main focus is looking at the functions in `KERNEL32.dll` because these functions are the essentials for things like memory management and other system-level tasks. Here's all of the functions the malware may access:<br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/functions.png"><br><img src="https://github.com/mushy2005/Malware-Analysis/blob/main/Malware%20Analysis/samples/ultima/images/functions2.png">


### Disclaimer
This sample is for educational purposes. Be sure to handle malware samples with caution.
